<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MiniLLM Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static_assets', filename='styles.css') }}" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="app-shell">
    <aside class="sidebar">
      <div class="brand">
        <h1>MiniLLM</h1>
        <p class="subtitle">LLM Madness style experiments</p>
        <div class="pill">Dashboard</div>
      </div>
      <nav class="side-nav">
        <button class="nav-btn active" data-section="overview">概览</button>
        <button class="nav-btn" data-section="datasets">数据集</button>
        <button class="nav-btn" data-section="configs">配置模板</button>
        <button class="nav-btn" data-section="runs">训练运行</button>
      </nav>
    </aside>
    <main>
      <section class="page-section active" data-section="overview">
        <div class="panel">
          <div class="panel-head">
            <div>
              <h2>总览</h2>
              <p class="meta">数据、配置与运行一目了然</p>
            </div>
            <div class="pill" id="latest-run-tag">最近运行：加载中...</div>
          </div>
          <div id="overview-grid" class="stat-grid"></div>
        </div>
      </section>

      <section class="page-section" data-section="datasets">
        <div class="panel">
          <div class="panel-head">
            <div>
              <h2>数据集</h2>
              <p class="meta">对齐 llm-madness 的快照体验</p>
            </div>
            <button id="build-snapshot" class="primary">生成快照</button>
          </div>
          <div class="controls">
            <input id="snapshot-name" type="text" placeholder="快照名称 (可选)" />
            <span class="meta">选择多份文本文件合并为 <code>out/datasets/&lt;name&gt;/combined.jsonl</code></span>
          </div>
          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th></th>
                  <th>路径</th>
                  <th>行数</th>
                  <th>大小</th>
                  <th>预览</th>
                </tr>
              </thead>
              <tbody id="dataset-table-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section class="page-section" data-section="configs">
        <div class="panel">
          <div class="panel-head">
            <div>
              <h2>配置模板</h2>
              <p class="meta">直接复用或粘贴至训练脚本</p>
            </div>
          </div>
          <div id="config-grid" class="card-grid"></div>
        </div>
      </section>

      <section class="page-section" data-section="runs">
        <div class="runs-layout">
          <div class="panel">
            <div class="panel-head">
              <div>
                <h2>训练运行</h2>
                <p class="meta">覆盖 PyTorch 与 MLX 任务</p>
              </div>
              <div class="panel-actions">
                <button id="refresh-runs" class="ghost">刷新</button>
              </div>
            </div>
            <div class="subpanel">
              <div class="subpanel-head">
                <h3>训练任务</h3>
                <div class="meta">从“配置模板”启动后会出现在这里</div>
              </div>
              <div id="jobs-list" class="artifact-list compact"></div>
            </div>
            <div class="subpanel">
              <div class="subpanel-head">
                <h3>运行记录</h3>
                <div class="meta">读取 out/ 与 TensorBoard 事件</div>
              </div>
            <div id="runs-list" class="artifact-list"></div>
            </div>
          </div>
          <div class="panel run-detail">
            <div class="panel-head">
              <div>
                <h2>运行详情</h2>
                <p class="meta" id="run-meta">选择左侧运行查看</p>
              </div>
            </div>
            <div id="run-summary"></div>
            <div id="mlx-summary" class="meta muted"></div>
            <div class="chart-block">
              <canvas id="run-chart" height="200"></canvas>
              <div id="chart-status" class="meta muted"></div>
            </div>
            <div class="subpanel">
              <div class="subpanel-head">
                <h3>训练状态</h3>
                <div class="panel-actions">
                  <button id="stop-job" class="danger ghost" disabled>停止</button>
                </div>
              </div>
              <div id="job-meta" class="meta muted">未选择任务</div>
              <pre id="job-log" class="log-tail"></pre>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
  <script type="module" src="{{ url_for('static_assets', filename='dashboard.js') }}"></script>
</body>
</html>
